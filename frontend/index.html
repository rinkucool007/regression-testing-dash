<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise Regression Testing Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #1e3a8a 0%, #2563eb 100%);
        }
        .log-window {
            transition: all 0.3s ease;
            height: 200px;
            overflow-y: auto;
            overflow-x: hidden;
        }
        .log-window.minimized {
            height: 40px;
            overflow: hidden;
        }
        .log-content {
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            background-color: #1a1a1a;
            color: #00ff00;
            padding: 10px;
            border-radius: 4px;
            min-height: 100%;
            max-height: 100%;
        }
        .priority-high {
            background-color: #ef4444;
            color: white;
        }
        .priority-medium {
            background-color: #f59e0b;
            color: white;
        }
        .priority-low {
            background-color: #10b981;
            color: white;
        }
        .status-pass {
            background-color: #10b981;
            color: white;
        }
        .status-fail {
            background-color: #ef4444;
            color: white;
        }
        .status-norun {
            background-color: #6b7280;
            color: white;
        }
        .blink {
            animation: blink 1s step-end infinite;
        }
        @keyframes blink {
            50% { opacity: 0; }
        }
        .shadow-lg {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .enterprise-card {
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
        }
        .running-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #3b82f6;
            margin-right: 5px;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(0.95); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
            100% { transform: scale(0.95); opacity: 1; }
        }
        .pagination-btn {
            padding: 0.5rem 1rem;
            margin: 0 0.25rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }
        .pagination-btn.active {
            background-color: #2563eb;
            color: white;
        }
        .pagination-btn.disabled {
            background-color: #d1d5db;
            cursor: not-allowed;
        }
        .search-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .search-container input {
            flex-grow: 1;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <!-- Login Screen -->
    <div id="login-screen" class="fixed inset-0 flex items-center justify-center gradient-bg">
        <div class="enterprise-card p-8 w-full max-w-md mx-4 shadow-lg">
            <div class="flex justify-center mb-8">
                <img src="logo.png" alt="Company Logo" class="h-20">
            </div>
            <h1 class="text-2xl font-bold text-center text-white mb-6">Enterprise Regression Testing</h1>
            <form id="login-form" class="space-y-6">
                <div>
                    <label for="username" class="block text-sm font-medium text-white mb-2">User ID</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fas fa-user text-gray-300"></i>
                        </div>
                        <input type="text" id="username" name="username" 
                            class="w-full pl-10 pr-4 py-3 bg-white bg-opacity-10 border border-white border-opacity-20 rounded-lg text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent" 
                            placeholder="Enter your user ID" required>
                    </div>
                </div>
                <div>
                    <label for="password" class="block text-sm font-medium text-white mb-2">Password</label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fas fa-lock text-gray-300"></i>
                        </div>
                        <input type="password" id="password" name="password" 
                            class="w-full pl-10 pr-4 py-3 bg-white bg-opacity-10 border border-white border-opacity-20 rounded-lg text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent" 
                            placeholder="Enter your password" required>
                    </div>
                </div>
                <div id="error-message" class="text-red-300 text-sm hidden">
                    <i class="fas fa-exclamation-circle mr-1"></i> Invalid credentials. Please try again.
                </div>
                <div>
                    <button id="login-btn" type="submit" 
                        class="w-full bg-white text-blue-600 py-3 px-4 rounded-lg font-medium hover:bg-opacity-90 transition duration-300 flex items-center justify-center">
                        <i class="fas fa-sign-in-alt mr-2"></i> Login
                    </button>
                </div>
            </form>
            <div class="mt-6 text-center text-sm text-white text-opacity-70">
                <p>For authorized personnel only. Unauthorized access prohibited.</p>
            </div>
        </div>
    </div>

    <!-- Dashboard (hidden initially) -->
    <div id="dashboard" class="hidden">
        <!-- Header -->
        <header class="bg-white shadow-sm">
            <div class="max-w-7xl mx-auto px-4 py-4 sm:px-6 lg:px-8 flex items-center">
                <img src="logo.png" alt="Company Logo" class="h-12 mr-4">
                <h1 class="text-2xl font-bold text-gray-900">Welcome to Regression Testing Dashboard</h1>
                <div class="ml-auto flex items-center space-x-4">
                    <button id="run-all-btn" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm flex items-center">
                        <span class="running-indicator hidden"></span>
                        Run All Tests
                    </button>
                    <button id="logout-btn" class="text-gray-600 hover:text-gray-900 flex items-center">
                        <i class="fas fa-sign-out-alt mr-2"></i> Logout
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 py-6 sm:px-6 lg:px-8">
            <div class="flex flex-col lg:flex-row gap-6">
                <!-- Test Cases Table (1/3 width) -->
                <div id="test-cases-container" class="w-full lg:w-1/3 bg-white rounded-lg shadow overflow-hidden">
                    <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-medium leading-6 text-gray-900">Test Scenarios</h3>
                            <div class="search-container">
                                <input type="text" id="search-input" 
                                    class="px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                    placeholder="Search by Scenario, Test Case, or Description">
                                <button id="clear-search" class="text-gray-500 hover:text-gray-700">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">SL</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Test Scenario</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Test Cases</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Priority</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200" id="test-cases-body">
                                <!-- Test cases will be dynamically added here -->
                            </tbody>
                        </table>
                    </div>
                    <!-- Pagination Controls -->
                    <div class="px-4 py-3 border-t border-gray-200 flex justify-center space-x-2">
                        <button id="prev-page" class="pagination-btn bg-gray-200 hover:bg-gray-300 text-gray-700 disabled:bg-gray-300 disabled:text-gray-500" disabled>Previous</button>
                        <div id="page-numbers" class="flex space-x-1"></div>
                        <button id="next-page" class="pagination-btn bg-gray-200 hover:bg-gray-300 text-gray-700 disabled:bg-gray-300 disabled:text-gray-500">Next</button>
                    </div>
                </div>

                <!-- Log Windows Container (2/3 width, hidden initially) -->
                <div id="log-container" class="hidden w-full lg:w-2/3 space-y-4">
                    <!-- Log windows will be dynamically added here -->
                </div>
            </div>
        </main>
    </div>

    <script>
        console.log('[DEBUG] Script loaded');

        // Initialize test cases data (20 test cases)
        const testCases = [
            { sl: 1, scenario: 'TS001', case: 'TC001', description: 'Run project 001', priority: 'High', status: 'No Run' },
            { sl: 2, scenario: 'TS002', case: 'TC002', description: 'Run project 002', priority: 'Medium', status: 'No Run' },
            { sl: 3, scenario: 'TS003', case: 'TC003', description: 'Run project 003', priority: 'Low', status: 'No Run' },
            { sl: 4, scenario: 'TS004', case: 'TC004', description: 'Run project 004', priority: 'High', status: 'No Run' },
            { sl: 5, scenario: 'TS005', case: 'TC005', description: 'Run project 005', priority: 'Medium', status: 'No Run' },
            { sl: 6, scenario: 'TS006', case: 'TC006', description: 'Run project 006', priority: 'Low', status: 'No Run' },
            { sl: 7, scenario: 'TS007', case: 'TC007', description: 'Run project 007', priority: 'High', status: 'No Run' },
            { sl: 8, scenario: 'TS008', case: 'TC008', description: 'Run project 008', priority: 'Medium', status: 'No Run' },
            { sl: 9, scenario: 'TS009', case: 'TC009', description: 'Run project 009', priority: 'Low', status: 'No Run' },
            { sl: 10, scenario: 'TS010', case: 'TC010', description: 'Run project 010', priority: 'High', status: 'No Run' },
            { sl: 11, scenario: 'TS011', case: 'TC011', description: 'Run project 011', priority: 'Medium', status: 'No Run' },
            { sl: 12, scenario: 'TS012', case: 'TC012', description: 'Run project 012', priority: 'Low', status: 'No Run' },
            { sl: 13, scenario: 'TS013', case: 'TC013', description: 'Run project 013', priority: 'High', status: 'No Run' },
            { sl: 14, scenario: 'TS014', case: 'TC014', description: 'Run project 014', priority: 'Medium', status: 'No Run' },
            { sl: 15, scenario: 'TS015', case: 'TC015', description: 'Run project 015', priority: 'Low', status: 'No Run' },
            { sl: 16, scenario: 'TS016', case: 'TC016', description: 'Run project 016', priority: 'High', status: 'No Run' },
            { sl: 17, scenario: 'TS017', case: 'TC017', description: 'Run project 017', priority: 'Medium', status: 'No Run' },
            { sl: 18, scenario: 'TS018', case: 'TC018', description: 'Run project 018', priority: 'Low', status: 'No Run' },
            { sl: 19, scenario: 'TS019', case: 'TC019', description: 'Run project 019', priority: 'High', status: 'No Run' },
            { sl: 20, scenario: 'TS020', case: 'TC020', description: 'Run project 020', priority: 'Medium', status: 'No Run' }
        ];

        // Backend API URL
        const API_URL = 'http://localhost:3001/execute';

        // Pagination settings
        const ITEMS_PER_PAGE = 15;
        let currentPage = parseInt(localStorage.getItem('currentPage')) || 1;
        let searchQuery = localStorage.getItem('searchQuery') || '';

        // Check login state on load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('[DEBUG] DOMContentLoaded event fired');
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            console.log('[DEBUG] isLoggedIn:', isLoggedIn);

            if (isLoggedIn) {
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                const searchInput = document.getElementById('search-input');
                if (searchInput && searchQuery) {
                    searchInput.value = searchQuery;
                }
                loadTestCases();
            }
        });

        // Login functionality
        document.addEventListener('DOMContentLoaded', function() {
            const loginForm = document.getElementById('login-form');
            const loginButton = document.getElementById('login-btn');

            if (!loginForm) {
                console.error('[ERROR] Login form (#login-form) not found');
                alert('Error: Login form not found. Please check the page source.');
                return;
            }
            if (!loginButton) {
                console.error('[ERROR] Login button (#login-btn) not found');
                alert('Error: Login button not found. Please check the page source.');
                return;
            }

            console.log('[DEBUG] Login form and button found, attaching event listeners');

            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();
                console.log('[DEBUG] Form submit event triggered');
                handleLogin();
            });

            loginButton.addEventListener('click', function(e) {
                e.preventDefault();
                console.log('[DEBUG] Login button click event triggered');
                handleLogin();
            });

            function handleLogin() {
                console.log('[DEBUG] handleLogin called');
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                const errorMessage = document.getElementById('error-message');

                console.log('[DEBUG] Login attempt - Username:', username, 'Password:', password);

                if (!username || !password || !errorMessage) {
                    console.error('[ERROR] Missing input elements or error message div');
                    alert('Error: Form elements missing. Please check the page.');
                    return;
                }

                errorMessage.classList.add('hidden');

                if (username === 'admin' && password === 'password') {
                    console.log('[DEBUG] Login successful');
                    localStorage.setItem('isLoggedIn', 'true');
                    document.getElementById('login-screen').classList.add('hidden');
                    document.getElementById('dashboard').classList.remove('hidden');
                    loadTestCases();
                } else {
                    console.log('[DEBUG] Login failed: Invalid credentials');
                    errorMessage.classList.remove('hidden');
                    document.getElementById('password').value = '';
                    document.getElementById('password').focus();
                }
            }
        });

        // Logout functionality
        document.addEventListener('DOMContentLoaded', function() {
            const logoutButton = document.getElementById('logout-btn');
            if (logoutButton) {
                logoutButton.addEventListener('click', function() {
                    console.log('[DEBUG] Logout button clicked');
                    localStorage.removeItem('isLoggedIn');
                    localStorage.removeItem('searchQuery');
                    localStorage.removeItem('currentPage');
                    document.getElementById('login-screen').classList.remove('hidden');
                    document.getElementById('dashboard').classList.add('hidden');
                    document.getElementById('username').value = '';
                    document.getElementById('password').value = '';
                    document.getElementById('error-message').classList.add('hidden');
                    
                    document.getElementById('log-container').innerHTML = '';
                    document.getElementById('log-container').classList.add('hidden');
                    document.getElementById('test-cases-container').classList.remove('lg:w-1/3');
                    document.getElementById('test-cases-container').classList.add('w-full');
                    document.getElementById('search-input').value = '';
                    searchQuery = '';
                    currentPage = 1;
                });
            }
        });

        // Search functionality
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('search-input');
            const clearSearch = document.getElementById('clear-search');

            if (searchInput && clearSearch) {
                searchInput.addEventListener('input', function() {
                    searchQuery = this.value.trim();
                    localStorage.setItem('searchQuery', searchQuery);
                    console.log('[DEBUG] Search query updated:', searchQuery);
                    currentPage = 1;
                    localStorage.setItem('currentPage', currentPage);
                    loadTestCases();
                });

                clearSearch.addEventListener('click', function() {
                    searchInput.value = '';
                    searchQuery = '';
                    localStorage.removeItem('searchQuery');
                    console.log('[DEBUG] Search cleared');
                    currentPage = 1;
                    localStorage.setItem('currentPage', currentPage);
                    loadTestCases();
                });
            } else {
                console.error('[ERROR] Search input or clear button not found');
            }
        });

        // Filter test cases based on search query
        function filterTestCases() {
            if (!searchQuery) return testCases;
            return testCases.filter(testCase => 
                testCase.scenario.toLowerCase().includes(searchQuery.toLowerCase()) ||
                testCase.case.toLowerCase().includes(searchQuery.toLowerCase()) ||
                testCase.description.toLowerCase().includes(searchQuery.toLowerCase())
            );
        }

        // Load test cases with pagination
        function loadTestCases() {
            console.log('[DEBUG] Loading test cases');
            const filteredTestCases = filterTestCases();
            const tbody = document.getElementById('test-cases-body');
            tbody.innerHTML = '';
            
            const totalPages = Math.ceil(filteredTestCases.length / ITEMS_PER_PAGE);
            const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;
            const endIndex = Math.min(startIndex + ITEMS_PER_PAGE, filteredTestCases.length);
            const paginatedTestCases = filteredTestCases.slice(startIndex, endIndex);
            
            paginatedTestCases.forEach(testCase => {
                const tr = document.createElement('tr');
                
                const prioritySelect = document.createElement('select');
                prioritySelect.className = `priority-${testCase.priority.toLowerCase()} px-2 py-1 text-xs rounded-full border-none focus:ring-2 focus:ring-blue-500`;
                prioritySelect.innerHTML = `
                    <option value="High" ${testCase.priority === 'High' ? 'selected' : ''} class="priority-high">High</option>
                    <option value="Medium" ${testCase.priority === 'Medium' ? 'selected' : ''} class="priority-medium">Medium</option>
                    <option value="Low" ${testCase.priority === 'Low' ? 'selected' : ''} class="priority-low">Low</option>
                `;
                
                const statusDisplay = document.createElement('div');
                statusDisplay.className = `status-${testCase.status.toLowerCase().replace(' ', '')} px-2 py-1 text-xs rounded-full inline-block`;
                statusDisplay.textContent = testCase.status;
                
                prioritySelect.addEventListener('change', function() {
                    const value = this.value.toLowerCase();
                    this.className = `priority-${value} px-2 py-1 text-xs rounded-full border-none focus:ring-2 focus:ring-blue-500`;
                });
                
                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${testCase.sl}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${testCase.scenario}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${testCase.case}</td>
                    <td class="px-6 py-4 text-sm text-gray-500">${testCase.description}</td>
                    <td class="px-6 py-4 whitespace-nowrap"></td>
                    <td class="px-6 py-4 whitespace-nowrap"></td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        <button class="execute-btn bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm flex items-center" data-testcase="${testCase.case}">
                            <span class="running-indicator hidden"></span>
                            Execute
                        </button>
                    </td>
                `;
                
                tr.querySelector('td:nth-child(5)').appendChild(prioritySelect);
                tr.querySelector('td:nth-child(6)').appendChild(statusDisplay);
                
                tbody.appendChild(tr);
            });
            
            updatePaginationControls(totalPages);
        }

        // Update pagination controls
        function updatePaginationControls(totalPages) {
            console.log('[DEBUG] Updating pagination controls');
            const prevButton = document.getElementById('prev-page');
            const nextButton = document.getElementById('next-page');
            const pageNumbersContainer = document.getElementById('page-numbers');
            pageNumbersContainer.innerHTML = '';
            
            prevButton.disabled = currentPage === 1;
            nextButton.disabled = currentPage === totalPages || totalPages === 0;
            
            for (let i = 1; i <= totalPages; i++) {
                const pageButton = document.createElement('button');
                pageButton.className = `pagination-btn ${i === currentPage ? 'active' : 'bg-gray-200 hover:bg-gray-300 text-gray-700'}`;
                pageButton.textContent = i;
                pageButton.addEventListener('click', () => {
                    currentPage = i;
                    localStorage.setItem('currentPage', currentPage);
                    loadTestCases();
                });
                pageNumbersContainer.appendChild(pageButton);
            }
            
            prevButton.onclick = () => {
                if (currentPage > 1) {
                    currentPage--;
                    localStorage.setItem('currentPage', currentPage);
                    loadTestCases();
                }
            };
            
            nextButton.onclick = () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    localStorage.setItem('currentPage', currentPage);
                    loadTestCases();
                }
            };
        }

        // Execute button functionality
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('execute-btn') || e.target.closest('.execute-btn')) {
                const btn = e.target.classList.contains('execute-btn') ? e.target : e.target.closest('.execute-btn');
                const testCase = btn.getAttribute('data-testcase');
                
                console.log('[DEBUG] Execute button clicked for test case:', testCase);
                const runningIndicator = btn.querySelector('.running-indicator');
                runningIndicator.classList.remove('hidden');
                btn.disabled = true;
                
                createLogWindow(testCase, btn);
                
                document.getElementById('log-container').classList.remove('hidden');
                document.getElementById('test-cases-container').classList.remove('w-full');
                document.getElementById('test-cases-container').classList.add('lg:w-1/3');
            }
            
            if (e.target.id === 'run-all-btn' || e.target.closest('#run-all-btn')) {
                console.log('[DEBUG] Run All Tests button clicked');
                const btn = document.getElementById('run-all-btn');
                const runningIndicator = btn.querySelector('.running-indicator');
                runningIndicator.classList.remove('hidden');
                btn.disabled = true;
                
                createLogWindow('ALL', btn, true);
                
                document.getElementById('log-container').classList.remove('hidden');
                document.getElementById('test-cases-container').classList.remove('w-full');
                document.getElementById('test-cases-container').classList.add('lg:w-1/3');
            }
            
            if (e.target.classList.contains('minimize-btn') || e.target.closest('.minimize-btn')) {
                console.log('[DEBUG] Minimize button clicked');
                const btn = e.target.classList.contains('minimize-btn') ? e.target : e.target.closest('.minimize-btn');
                const logWindow = btn.closest('.log-window');
                logWindow.classList.toggle('minimized');
                
                const icon = btn.querySelector('i');
                if (logWindow.classList.contains('minimized')) {
                    icon.classList.remove('fa-window-minimize');
                    icon.classList.add('fa-window-maximize');
                } else {
                    icon.classList.remove('fa-window-maximize');
                    icon.classList.add('fa-window-minimize');
                }
            }
            
            if (e.target.classList.contains('close-btn') || e.target.closest('.close-btn')) {
                console.log('[DEBUG] Close button clicked');
                const btn = e.target.classList.contains('close-btn') ? e.target : e.target.closest('.close-btn');
                const logWindow = btn.closest('.log-window');
                logWindow.remove();
                
                if (document.querySelectorAll('.log-window').length === 0) {
                    document.getElementById('log-container').classList.add('hidden');
                    document.getElementById('test-cases-container').classList.remove('lg:w-1/3');
                    document.getElementById('test-cases-container').classList.add('w-full');
                }
            }
        });

        // Create a new log window
        function createLogWindow(testCase, executeBtn, isRunAll = false) {
            console.log('[DEBUG] Creating log window for:', testCase);
            const existingWindow = document.querySelector(`.log-window[data-testcase="${testCase}"]`);
            if (existingWindow) {
                existingWindow.classList.remove('minimized');
                existingWindow.scrollIntoView({ behavior: 'smooth' });
                return;
            }
            
            const logContainer = document.getElementById('log-container');
            const logWindow = document.createElement('div');
            logWindow.className = 'log-window bg-white rounded-lg shadow overflow-hidden';
            logWindow.setAttribute('data-testcase', testCase);
            
            const header = document.createElement('div');
            header.className = 'px-4 py-3 border-b border-gray-200 flex justify-between items-center bg-gray-50';
            header.innerHTML = `
                <h4 class="font-medium">Execution Log: ${isRunAll ? 'All Tests' : testCase}</h4>
                <div class="flex space-x-2">
                    <button class="minimize-btn text-gray-500 hover:text-gray-700">
                        <i class="fas fa-window-minimize"></i>
                    </button>
                    <button class="close-btn text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            const content = document.createElement('div');
            content.className = 'log-content p-4';
            
            const cursor = document.createElement('span');
            cursor.className = 'blink';
            cursor.textContent = '_';
            
            logWindow.appendChild(header);
            logWindow.appendChild(content);
            logContainer.appendChild(logWindow);
            
            logWindow.scrollIntoView({ behavior: 'smooth' });
            
            executeTestCase(testCase, content, cursor, executeBtn, isRunAll);
        }

        // Execute a test case by calling the backend API
        async function executeTestCase(testCase, contentElement, cursorElement, executeBtn, isRunAll = false) {
            console.log('[DEBUG] Executing test case:', testCase);
            contentElement.innerHTML = '';
            
            const initialMsg = document.createElement('div');
            initialMsg.textContent = `Starting execution of ${isRunAll ? 'all tests' : testCase}...\n`;
            contentElement.appendChild(initialMsg);
            
            contentElement.appendChild(cursorElement);
            contentElement.scrollTop = contentElement.scrollHeight;
            
            const batchFileMap = {
                'TC001': 'test1.bat',
                'TC002': 'test2.bat',
                'TC003': 'test3.bat',
                'TC004': 'test4.bat',
                'TC005': 'test5.bat',
                'TC006': 'test6.bat',
                'TC007': 'test7.bat',
                'TC008': 'test8.bat',
                'TC009': 'test9.bat',
                'TC010': 'test10.bat',
                'TC011': 'test11.bat',
                'TC012': 'test12.bat',
                'TC013': 'test13.bat',
                'TC014': 'test14.bat',
                'TC015': 'test15.bat',
                'TC016': 'test16.bat',
                'TC017': 'test17.bat',
                'TC018': 'test18.bat',
                'TC019': 'test19.bat',
                'TC020': 'test20.bat'
            };
            const batchFile = isRunAll ? 'all tests' : batchFileMap[testCase] || 'unknown.bat';
            
            // Validate batch file extension
            if (!isRunAll && !batchFile.endsWith('.bat')) {
                console.error('[ERROR] Invalid batch file extension for test case:', testCase, 'File:', batchFile);
                const errorMsg = document.createElement('div');
                errorMsg.textContent = `Error: Invalid batch file extension (${batchFile}). Expected .bat\n`;
                contentElement.appendChild(errorMsg);
                contentElement.appendChild(cursorElement);
                contentElement.scrollTop = contentElement.scrollHeight;
                const runningIndicator = executeBtn.querySelector('.running-indicator');
                runningIndicator.classList.add('hidden');
                executeBtn.disabled = false;
                return;
            }
            
            console.log('[DEBUG] Batch file mapped:', batchFile);
            
            setTimeout(async () => {
                cursorElement.remove();
                
                const commandMsg = document.createElement('div');
                commandMsg.textContent = `> Executing: ${batchFile}\n`;
                contentElement.appendChild(commandMsg);
                
                contentElement.scrollTop = contentElement.scrollHeight;
                
                try {
                    console.log('[DEBUG] Sending fetch request to:', API_URL, 'with payload:', JSON.stringify({ testCase: isRunAll ? 'ALL' : testCase }));
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ testCase: isRunAll ? 'ALL' : testCase })
                    });
                    
                    console.log('[DEBUG] Fetch response status:', response.status, 'OK:', response.ok);
                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error('[ERROR] Fetch failed with status:', response.status, 'Response:', errorText);
                        throw new Error(`HTTP ${response.status}: ${errorText || 'Unknown error'}`);
                    }
                    
                    const result = await response.json();
                    console.log('[DEBUG] Fetch response data:', result);
                    
                    if (!result.success) {
                        console.error('[ERROR] Backend reported failure:', result.output);
                        throw new Error(result.output || 'Backend execution failed');
                    }
                    
                    result.results.forEach(res => {
                        const testCaseId = res.testCase;
                        const outputMsg = document.createElement('div');
                        
                        // Display folder path if provided
                        if (res.folderPath && res.status === 'Pending') {
                            outputMsg.textContent = `Test ${testCaseId}:\n${res.output}\n`;
                        } else {
                            outputMsg.textContent = `Test ${testCaseId}:\n${res.output}\n`;
                            const completionMsg = document.createElement('div');
                            completionMsg.textContent = `Execution of ${testCaseId} ${res.status.toLowerCase()}ed.\n`;
                            contentElement.appendChild(completionMsg);
                            
                            let statusDisplay = null;
                            const rows = document.querySelectorAll('#test-cases-body tr');
                            for (const row of rows) {
                                const testCaseCell = row.querySelector('td:nth-child(3)');
                                if (testCaseCell && testCaseCell.textContent === testCaseId) {
                                    statusDisplay = row.querySelector('td:nth-child(6) div');
                                    break;
                                }
                            }
                            if (statusDisplay) {
                                statusDisplay.textContent = res.status;
                                statusDisplay.className = `status-${res.status.toLowerCase()} px-2 py-1 text-xs rounded-full inline-block`;
                            }
                        }
                        
                        contentElement.appendChild(outputMsg);
                        contentElement.scrollTop = contentElement.scrollHeight;
                    });
                    
                    const timestamp = document.createElement('div');
                    timestamp.className = 'text-gray-400 mt-2';
                    timestamp.textContent = `[${new Date().toLocaleString()}]`;
                    contentElement.appendChild(timestamp);
                    
                    contentElement.appendChild(cursorElement);
                    contentElement.scrollTop = contentElement.scrollHeight;
                    
                } catch (error) {
                    console.error('[ERROR] Execution error for test case:', testCase, 'Error:', error.message);
                    const errorMsg = document.createElement('div');
                    errorMsg.textContent = `Error: ${error.message}\n`;
                    contentElement.appendChild(errorMsg);
                    
                    const completionMsg = document.createElement('div');
                    completionMsg.textContent = `\nExecution of ${isRunAll ? 'all tests' : testCase} failed.\n`;
                    contentElement.appendChild(completionMsg);
                    
                    const timestamp = document.createElement('div');
                    timestamp.className = 'text-gray-400 mt-2';
                    timestamp.textContent = `[${new Date().toLocaleString()}]`;
                    contentElement.appendChild(timestamp);
                    
                    contentElement.appendChild(cursorElement);
                    contentElement.scrollTop = contentElement.scrollHeight;
                    
                    if (!isRunAll) {
                        const statusDisplay = executeBtn.closest('tr').querySelector('td:nth-child(6) div');
                        if (statusDisplay) {
                            statusDisplay.textContent = 'Fail';
                            statusDisplay.className = `status-fail px-2 py-1 text-xs rounded-full inline-block`;
                        }
                    }
                }
                
                const runningIndicator = executeBtn.querySelector('.running-indicator');
                runningIndicator.classList.add('hidden');
                executeBtn.disabled = false;
                
            }, 500);
        }
    </script>
</body>
</html>
